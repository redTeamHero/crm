<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Metro 2 CRM</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#AF52DE" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/style.css" />
  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.4);
      --glass-brd: rgba(255,255,255,0.25);
      --muted:#6b7280;
      --green:#22c55e;
      --green-bg:#22c55e;
      --accent:#007AFF;
      --accent-bg:#007AFF;

    }
    .glass{ background:var(--glass-bg); border:1px solid var(--glass-brd); border-radius:18px; backdrop-filter:blur(12px) saturate(180%); box-shadow:0 8px 24px rgba(0,0,0,.1) }
    .card{ border-radius:18px; padding:16px }
    .chip{ border:1px solid var(--glass-brd); padding:4px 10px; border-radius:999px; font-size:12px; background:rgba(255,255,255,.7); cursor:pointer; user-select:none }
    .chip.active{ background:var(--accent-bg); border-color:var(--accent); color:#fff }
    .muted{ color:var(--muted) }
    .tl-card{ transition:transform .2s ease, box-shadow .15s ease, background .15s ease; }
    .tl-card:hover{ transform: translateY(-1px) scale(1.01) }
    .tl-card.selected{ box-shadow:0 0 0 2px var(--green); }
    .tl-card.selected input[type="checkbox"]{ accent-color: var(--green); }
    .tl-card.negative{ box-shadow:0 0 0 2px #ef4444 inset, 0 8px 24px rgba(0,0,0,.1); background:rgba(239,68,68,.12); }
    .wrap-anywhere{ overflow-wrap:anywhere; word-break:break-word }
    .hidden{ display:none }
    .focus-ring{ outline: 2px dashed #6366f1; outline-offset: 4px; }

    /* Modes */
    .tl-card.mode-identity{ box-shadow:0 0 0 2px #d4af37 inset, 0 8px 24px rgba(0,0,0,.1); background: rgba(212,175,55,.12); }
    .tl-card.mode-breach{   box-shadow:0 0 0 2px #ef4444 inset, 0 8px 24px rgba(0,0,0,.1); background: rgba(239,68,68,.12); }
    .tl-card.mode-assault{  box-shadow:0 0 0 2px #ec4899 inset, 0 8px 24px rgba(0,0,0,.1); background: rgba(236,72,153,.12); }

    .chip-mini{ font-size:11px; padding:2px 8px; }
    .chip-identity{ border-color:#d4af37; color:#8b6f00; background:rgba(212,175,55,.15); }
    .chip-breach{   border-color:#ef4444; color:#991b1b; background:rgba(239,68,68,.15); }
    .chip-assault{  border-color:#ec4899; color:#9d174d; background:rgba(236,72,153,.15); }

    .mode-btn.active{ box-shadow:0 0 0 2px #1f2937 inset; background:#eef2ff; }

    /* Tooltip bubble */
    .btn[data-tip]:hover::after,
    .chip[data-tip]:hover::after{
      content: attr(data-tip);
      position:absolute; left:50%; transform:translateX(-50%); bottom: calc(100% + 8px);
      background: rgba(17,24,39,.95); color:white; font-size:12px; padding:6px 8px; border-radius:8px; white-space:nowrap; box-shadow:0 6px 18px rgba(0,0,0,.2); z-index:40;
    }
    .btn[data-tip]:hover::before,
    .chip[data-tip]:hover::before{
      content:""; position:absolute; left:50%; transform:translateX(-50%); bottom: 100%;
      border:6px solid transparent; border-top-color: rgba(17,24,39,.95); z-index:39;
    }

    /* Zoom modal */
    #zoomModal { z-index: 60; }
    #zoomCard { max-height: 85vh; overflow: auto; }
  </style>
</head>
<body>
<header class="p-4">
  <div class="max-w-7xl mx-auto glass card flex items-center justify-between">
    <div class="text-xl font-semibold">Metro 2 CRM</div>
    <div class="flex items-center gap-2">
      <a href="/dashboard" class="btn">Dashboard</a>
      <a href="/clients" class="btn">Clients</a>
      <a href="/leads" class="btn">Leads</a>
      <a href="/schedule" class="btn">Schedule</a>
      <a id="navCompany" href="/my-company" class="btn">My Company</a>
      <a href="/billing" class="btn">Billing</a>
      <a href="/letters" class="btn">Letter</a>
      <a href="/settings" class="btn">Settings</a>
      <a href="/library" class="btn">Library</a>
      <button id="btnHelp" class="btn" data-tip="Help (H)">Help</button>
      <button id="btnInvite" class="btn" style="background: var(--green-bg);">Invite +</button>
    </div>
  </div>
</header>

<!-- Client Tracker -->
<div class="max-w-7xl mx-auto">
  <div class="glass card">
    <div class="text-center">
      <div class="mb-1 flex items-center justify-center gap-2">
        <div class="font-medium">Client Tracker</div>
        <div id="stepControls" class="flex items-center gap-2 text-sm">
          <button id="addStep" class="btn text-[10px]" title="Add step">+</button>
        </div>
      </div>
      <div id="trackerSteps" class="flex flex-wrap justify-center gap-4 text-sm"></div>
    </div>
  </div>
</div>

<main class="max-w-7xl mx-auto p-4 space-y-4">
  <div id="err" class="hidden p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg"></div>

  <section class="grid md:grid-cols-[320px,1fr] gap-4">
    <!-- Consumers -->
    <aside class="glass card space-y-2">
      <div class="flex items-center justify-between">
        <div class="font-semibold">Consumers</div>
        <div class="flex gap-2">
          <button id="btnNewConsumer" class="btn text-sm" data-tip="New Consumer (N)">New</button>
          <button id="btnEditConsumer" class="btn text-sm" data-tip="Edit Consumer (E)">Edit</button>
        </div>
      </div>
      <input id="consumerSearch" placeholder="Search consumers..." class="w-full border rounded px-2 py-1 text-sm" />
      <div id="consumerList" class="space-y-2 max-h-96 overflow-y-auto"></div>
      <div class="flex items-center justify-between pt-2">
        <button id="consPrev" class="btn text-sm">Prev</button>
        <div class="text-sm muted">Page <span id="consPage">1</span> / <span id="consPages">1</span></div>
        <button id="consNext" class="btn text-sm">Next</button>
      </div>
    </aside>

    <!-- Right side -->
    <section class="space-y-4">
        <div class="glass card">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">Messages</div>
          <button id="btnSendMsg" class="btn text-sm">Send</button>
        </div>
        <div id="msgList" class="space-y-2 text-sm max-h-48 overflow-y-auto"></div>
        <textarea id="msgInput" class="w-full border rounded p-2 text-sm" rows="2" placeholder="Type message..."></textarea>
      </div>
      <div class="glass card">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-semibold">Selected Consumer: <span id="selConsumer">—</span></div>
            <div class="text-sm muted">Report: <select id="reportPicker" class="border rounded px-2 py-1 text-sm"></select></div>
          </div>
          <div class="flex gap-2">
            <button id="btnUpload" class="chip" data-tip="Upload HTML (U)">Upload HTML</button>
            <button id="btnDataBreach" class="chip" data-tip="Databreach options">Databreach</button>
            <button id="btnAuditReport" class="chip" data-tip="Run audit on current report">Audit</button>
            <button id="btnDeleteReport" class="chip" data-tip="Delete current report (click)">Delete Report</button>
            <input id="fileInput" type="file" accept=".html,.htm,text/html" class="hidden" />
          </div>
        </div>
      </div>
      <div class="glass card">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">Files & Activity</div>
          <div class="flex items-center gap-2">
            <input id="activityFile" type="file" class="hidden" />
            <button id="btnAddFile" class="btn" data-tip="Upload file to this consumer">+ Add File</button>
            <a id="activityPortalLink" class="btn hidden" href="#" target="_blank">Client Portal</a>
          </div>
        </div>
        <div id="activityList" class="space-y-2 text-sm max-h-48 overflow-y-auto"></div>
      </div>
    
      <div class="glass card">
        <div class="text-center">
          <div class="font-medium mb-2">Quick Actions</div>
          <div id="modeBar" class="flex gap-2 flex-wrap justify-center"></div>
          <div class="text-sm muted mt-1">
            Click a mode, then click tradeline cards to tag them. Click the mode again to exit.
          </div>
        </div>
        <div class="font-semibold mb-2 mt-4">Filters</div>
        <div id="filterBar" class="flex flex-wrap gap-2"></div>
        <button id="btnClearFilters" class="btn mt-2" data-tip="Clear Filters (C)">Clear Filters</button>
      </div>

      <div class="glass card">
        <div class="flex items-center justify-between">
          <div class="font-semibold">Tradelines</div>
          <div class="flex items-center gap-3">
            <label class="text-sm flex items-center gap-2" title="Generate correction letters">
              <input type="radio" name="rtype" value="correct" checked /> Correct
            </label>
            <label class="text-sm flex items-center gap-2" title="Generate deletion letters">
              <input type="radio" name="rtype" value="delete" /> Delete
            </label>
            <label class="text-sm flex items-center gap-2" title="Generate debt collector letters">
              <input type="checkbox" id="cbCollectors" /> Collectors
            </label>

            <label class="text-sm flex items-center gap-2" title="Generate personal information letters">
              <input type="checkbox" id="cbPersonalInfo" /> Personal Info
            </label>
            <button id="btnSelectAll" class="btn text-sm" data-tip="Select or deselect all tradelines">Select All</button>
            <button id="btnGenerate" class="btn" data-tip="Generate Letters (G)">Generate Letters</button>
          </div>
        </div>
        <div class="text-xs muted mt-1">Tip: Click any card to zoom for full detail.</div>
        <div id="tlList" class="grid gap-3 mt-3 grid-cols-1 md:grid-cols-2 xl:grid-cols-3"></div>
        <div id="tlPager" class="flex items-center justify-between mt-3">
          <button id="tlPrev" class="btn text-sm">Prev</button>
          <div class="flex items-center gap-2">
            <div class="text-sm muted">Page <span id="tlPage">1</span> / <span id="tlPages">1</span></div>
            <select id="tlPageSize" class="border rounded text-sm">
              <option value="3">3</option>
              <option value="6" selected>6</option>
              <option value="9">9</option>
              <option value="12">12</option>
              <option value="15">15</option>
              <option value="all">All</option>
            </select>
          </div>
          <button id="tlNext" class="btn text-sm">Next</button>
        </div>
      </div>

      <div class="glass card">
        <div class="font-semibold">Debt Collectors</div>
        <div id="collectorList" class="space-y-2 mt-2"></div>
      </div>


      <!-- Files & Activity -->
    
    </section>
  </section>
</main>

<!-- Consumer list item template -->
<template id="consumerItem">
  <div class="glass card consumer-card cursor-pointer">
    <div class="flex items-start justify-between">
      <div>
        <div class="name font-medium"></div>
        <div class="email text-sm muted"></div>
      </div>
      <button class="delete btn" data-tip="Delete Consumer (click)">×</button>
    </div>
  </div>
</template>

<!-- Tradeline card template -->
<template id="tlTemplate">
  <div class="glass card tl-card" data-index="">
    <div class="tl-head flex items-start justify-between gap-2">
      <div class="wrap-anywhere">
        <div class="font-semibold tl-creditor"></div>
        <div class="text-xs muted">Index <span class="tl-idx"></span></div>
        <div class="text-xs muted mt-1">
          TU: <span class="tl-tu-acct"></span> •
          EXP: <span class="tl-exp-acct"></span> •
          EQF: <span class="tl-eqf-acct"></span>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <div class="special-badges flex gap-1"></div>
        <select class="tl-playbook-select hidden text-sm border rounded"></select>
        <button class="tl-playbook btn" title="Select playbook">Playbook</button>
        <button class="tl-remove btn" title="Hide this card" data-tip="Remove Card (R when focused)">×</button>
      </div>
    </div>

    <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
      <label class="flex items-center gap-2"><input type="checkbox" class="bureau" value="TransUnion" /> TransUnion</label>
      <label class="flex items-center gap-2"><input type="checkbox" class="bureau" value="Experian" /> Experian</label>
      <label class="flex items-center gap-2"><input type="checkbox" class="bureau" value="Equifax" /> Equifax</label>
    </div>

    <div class="mt-2 flex items-center gap-2 text-xs">
      <label class="flex items-center gap-1"><input type="checkbox" class="use-gpt" /> AI Reword</label>
      <select class="gpt-tone border rounded px-1 py-0.5">
        <option value="Professional & Polite">Professional & Polite</option>
        <option value="Firm / Legalistic (No-Nonsense)">Firm / Legalistic (No-Nonsense)</option>
        <option value="Plain-English / Conversational">Plain-English / Conversational</option>
        <option value="Cooperative / Helpful (Problem-Solving)">Cooperative / Helpful (Problem-Solving)</option>
        <option value="Urgent / Concerned (Still Respectful)">Urgent / Concerned (Still Respectful)</option>
      </select>
      <label class="flex items-center gap-1"><input type="checkbox" class="use-ocr" /> OCR</label>
    </div>

    <div class="tl-tags flex gap-2 mt-2 flex-wrap"></div>
    <div class="mt-3">
      <div class="space-y-1 tl-violations text-sm"></div>
      <div class="flex justify-end gap-2 mt-1 text-xs">
        <button class="tl-reason-prev btn text-xs hidden">Prev</button>
        <button class="tl-reason-next btn text-xs hidden">Next</button>
      </div>




    </div>
  </div>
</template>

<!-- Inquiry item template -->
<template id="inqTemplate">
  <div class="flex items-center gap-2">
    <input type="checkbox" class="inq-dispute" />
    <div class="flex-1">
      <div class="font-medium inq-creditor"></div>
      <div class="text-xs muted"><span class="inq-bureau"></span> • <span class="inq-date"></span></div>
    </div>
  </div>
</template>

<!-- Inquiry item template -->
<!-- Debt collector item template -->
  <template id="collectorTemplate">
    <div class="flex items-center gap-2">
      <input type="checkbox" class="collector-pick" />
      <div class="flex-1">
        <div class="font-medium collector-name"></div>
        <div class="text-xs muted collector-address"></div>
        <div class="text-xs muted collector-phone"></div>
      </div>
    </div>
  </template>

<!-- New Consumer Modal -->
<div id="newModal" class="fixed inset-0 hidden items-center justify-center bg-[rgba(0,0,0,.45)]">
  <form id="newForm" class="glass card w-[min(560px,92vw)] space-y-3">
    <div class="flex items-center justify-between">
      <div class="font-semibold">New Consumer</div>
      <div class="flex gap-2">
        <button type="button" id="newCancel" class="btn" data-tip="Cancel / Clear (C)">Cancel</button>
        <button type="button" id="newClose" class="btn" data-tip="Close">×</button>
        <button class="btn" type="submit" data-tip="Create (S)">Create</button>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-2 text-sm">
      <label class="flex flex-col">Name<input name="name" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Email<input name="email" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Phone<input name="phone" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">SSN last 4<input name="ssn_last4" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">DOB<input name="dob" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col col-span-2">Address 1<input name="addr1" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col col-span-2">Address 2<input name="addr2" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">City<input name="city" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">State<input name="state" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Zip<input name="zip" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Sale<input name="sale" type="number" step="0.01" class="border rounded px-2 py-1" /></label>
      <label class="flex flex-col">Paid<input name="paid" type="number" step="0.01" class="border rounded px-2 py-1" /></label>
      <label class="flex flex-col">Status<select name="status" class="border rounded px-2 py-1"><option value="active" selected>Active</option><option value="completed">Completed</option><option value="dropped">Dropped</option></select></label>

    </div>
    <div class="text-xs muted">Tip: Press <b>S</b> to create, <b>C</b> to clear/cancel.</div>
  </form>
</div>

<!-- Edit Consumer Modal -->
<div id="editModal" class="fixed inset-0 hidden items-center justify-center bg-[rgba(0,0,0,.45)]">
  <form id="editForm" class="glass card w-[min(560px,92vw)] space-y-3">
    <div class="flex items-center justify-between">
      <div class="font-semibold">Edit Consumer</div>
      <div class="flex gap-2">
        <button type="button" id="editCancel" class="btn" data-tip="Cancel / Clear (C)">Cancel</button>
        <button type="button" id="editClose" class="btn" data-tip="Close">×</button>
        <button class="btn" type="submit" data-tip="Save (S)">Save</button>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-2 text-sm">
      <label class="flex flex-col">Name<input name="name" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Email<input name="email" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Phone<input name="phone" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">SSN last 4<input name="ssn_last4" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">DOB<input name="dob" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col col-span-2">Address 1<input name="addr1" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col col-span-2">Address 2<input name="addr2" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">City<input name="city" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">State<input name="state" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Zip<input name="zip" class="border rounded px-2 py-1"></label>
      <label class="flex flex-col">Sale<input name="sale" type="number" step="0.01" class="border rounded px-2 py-1" /></label>
      <label class="flex flex-col">Paid<input name="paid" type="number" step="0.01" class="border rounded px-2 py-1" /></label>
      <label class="flex flex-col">Status<select name="status" class="border rounded px-2 py-1"><option value="active">Active</option><option value="completed">Completed</option><option value="dropped">Dropped</option></select></label>

    </div>
    <div class="text-xs muted">Tip: Press <b>S</b> to save, <b>C</b> to clear/cancel.</div>
  </form>
</div>

<!-- Zoom Modal (tradeline details) -->
<div id="zoomModal" class="fixed inset-0 hidden items-center justify-center bg-[rgba(0,0,0,.55)]">
  <div id="zoomCard" class="glass card w-[min(900px,95vw)]">
    <div class="flex items-center justify-between mb-2">
      <div class="font-semibold">Tradeline Details</div>
      <button id="zoomClose" class="btn">×</button>
    </div>
    <div id="zoomBody" class="text-sm"></div>
  </div>
</div>

<!-- Data Breach Results Modal -->
<div id="breachModal" class="fixed inset-0 hidden items-center justify-center bg-[rgba(0,0,0,.55)] z-50">
  <div class="glass card w-[min(600px,95vw)]">
    <div class="flex items-center justify-between mb-2">
      <div class="font-semibold">Data Breach Results</div>
      <button id="breachClose" class="btn">×</button>
    </div>
    <div id="breachBody" class="text-sm max-h-64 overflow-y-auto"></div>
    <div class="text-right mt-3">
      <button id="breachSend" class="btn">Send Audit PDF</button>
    </div>
  </div>
</div>

<!-- Help Modal (unchanged logic, bound in index.js hotkeys too) -->
<div id="helpModal" class="fixed inset-0 hidden items-center justify-center bg-[rgba(0,0,0,.45)] z-50">
  <div class="glass card w-[min(720px,92vw)]">
    <div class="flex items-center justify-between mb-2">
      <div class="font-semibold">Hotkeys & Tips</div>
      <button id="helpClose" class="btn">×</button>
    </div>
    <div class="text-sm space-y-2">
      <div class="grid grid-cols-2 gap-3">
        <div class="glass card p-2">
          <div class="font-medium mb-1">Global</div>
          <ul class="list-disc list-inside">
            <li><b>N</b> – New consumer</li>
            <li><b>U</b> – Upload HTML</li>
            <li><b>E</b> – Edit consumer</li>
            <li><b>G</b> – Generate letters</li>
            <li><b>C</b> – Clear (context-aware)</li>
            <li><b>H</b> – Help overlay</li>
            <li><b>R</b> – Remove focused tradeline card</li>
          </ul>
        </div>
        <div class="glass card p-2">
          <div class="font-medium mb-1">Modes / Cards</div>
          <ul class="list-disc list-inside">
            <li>Modes: <b>I</b>=Identity Theft, <b>D</b>=Data Breach, <b>S</b>=Sexual Assault</li>
            <li>Click a card to zoom; press <b>A</b> to toggle all bureaus on that card.</li>
            <li>Press <b>Esc</b> to exit a mode.</li>
          </ul>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <a class="btn" href="/quiz.html" target="_blank">Try Hotkeys Quiz</a>
        <div class="text-xs muted">Opens new tab</div>
      </div>
    </div>
  </div>
</div>

<script src="common.js"></script>
<script src="hotkeys.js"></script>
<script type="module" src="index.js"></script>
</body>
</html>
