<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Library</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
<script>
(() => {
  const themes = {
    purple:{accent:'#AF52DE',hover:'#9333EA',bg:'#AF52DE',
            glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'},
    blue:{accent:'#007AFF',hover:'#005BB5',bg:'#007AFF',
          glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'},
    green:{accent:'#34C759',hover:'#248A3D',bg:'#34C759',
           glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'}
    // ‚Ä¶keep the rest of your themes
  };
  const name = localStorage.getItem('theme') || 'purple';
  const t = themes[name] || themes.purple;
  const r = document.documentElement.style;
  r.setProperty('--accent', t.accent);
  r.setProperty('--accent-hover', t.hover);
  r.setProperty('--accent-bg', t.bg);
  r.setProperty('--glass-bg', t.glassBg);
  r.setProperty('--glass-brd', t.glassBrd);
  r.setProperty('--btn-text', '#fff');
  document.documentElement.style.visibility = 'hidden';
  document.addEventListener('DOMContentLoaded', () => {
    document.documentElement.style.visibility = '';
  });
})();
</script>
<link rel="stylesheet" href="/style.css">
  <style>
    /*
      The template panel previously used fixed positioning, which
      caused it to overlap the Sequences section. Setting it to
      relative positioning keeps the panel within the normal flow and
      allows the rest of the page to render correctly.
    */
    #templatePanel {
      position: relative;
      margin: 0 auto;
      width: 90vw;
      max-width: 1100px;
    }

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(1100px,96vw);max-height:min(90vh,900px);border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.25);background:white;display:flex;flex-direction:column;overflow:hidden}
    .modal header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;border-bottom:1px solid rgba(0,0,0,.08);background:var(--glass-bg);backdrop-filter: blur(10px)}
    .modal .body{padding:16px;overflow-y:auto}
  </style>
</head>
<body>
<header id="host-nav" class="p-4">
  <div class="max-w-7xl mx-auto glass card nav-shell">
    <div class="nav-brand-row">
      <div class="text-xl font-semibold">Metro 2 CRM</div>
      <button id="navToggle" class="btn md:hidden" type="button" aria-expanded="false" aria-controls="primaryNav">
        <span>Menu</span>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav id="primaryNav" class="hidden flex-col gap-2 md:flex md:flex-row md:items-center md:gap-2" aria-label="Primary">
      <div id="primaryNavLinks" class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
        <a href="/dashboard" class="btn nav-btn">Dashboard</a>
        <a href="/clients" class="btn nav-btn">Clients</a>
        <a href="/leads" class="btn nav-btn">Leads</a>
        <a href="/schedule" class="btn nav-btn">Schedule</a>
        <a href="/billing" class="btn nav-btn">Billing</a>
        <div class="nav-dropdown" id="navSettings">
          <button type="button" id="navSettingsToggle" class="btn nav-btn flex items-center justify-between md:justify-center gap-2" aria-expanded="false" aria-haspopup="true">
            <span>Settings</span>
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div id="navSettingsMenu" class="nav-dropdown-menu glass card p-2">
            <a id="navCompany" href="/my-company" class="btn text-sm">My Company</a>
            <a href="/letters" class="btn text-sm">Letter</a>
            <a href="/library" class="btn text-sm">Library</a>
            <a href="/workflows" class="btn text-sm">Workflows</a>
            <button id="btnInvite" class="btn text-sm" style="background: var(--green-bg);">Add Team Member</button>
          </div>
        </div>
        <a href="/tradelines" class="btn nav-btn">Tradelines</a>
        <button id="btnHelp" class="btn nav-btn" data-tip="Help (H)">Help</button>
        <div id="tierBadge" class="hidden sm:flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-2 text-emerald-700 shadow-sm" title="You've started your journey.">
          <span class="text-xl">üìÑ</span>
          <span class="font-semibold text-sm">Rookie</span>
        </div>
      </div>
    </nav>
  </div>
</header>

<main class="max-w-5xl mx-auto p-4 space-y-4">
  <section class="glass card space-y-4" aria-labelledby="default-pack-heading">
    <div class="flex flex-col gap-1">
      <div class="flex flex-wrap items-center justify-between gap-2">
        <div>
          <h2 id="default-pack-heading" class="font-medium">Default Dispute Pack ‚Ä¢ Paquete Disputa Premium</h2>
          <p class="text-xs text-slate-500">Curate the five ‚Äúfront row‚Äù templates your team sells most. Selecciona cartas clave EN/ES para el upsell Apple-grade.</p>
        </div>
        <button id="refreshDefaults" class="btn text-sm">Refresh / Actualizar</button>
      </div>
      <p id="defaultPackStatus" class="hidden rounded-lg bg-emerald-100 px-3 py-2 text-xs text-emerald-700"></p>
    </div>
    <div id="defaultPackGrid" class="grid gap-3 md:grid-cols-2"></div>
    <p id="defaultPackEmpty" class="text-sm text-slate-500">Add templates to curate your premium pack. Agrega plantillas para mostrar tu experiencia.</p>
  </section>

  <div id="templatePanel" class="glass card space-y-4">
    <div class="flex items-center justify-between">
      <div class="font-medium">Letter Templates</div>
      <button id="newTemplate" class="btn text-sm">New Template</button>
    </div>
    <div id="templateList" class="space-y-1 text-sm max-h-96 overflow-y-auto"></div>
  </div>

  <section class="glass card space-y-4" aria-labelledby="contracts-heading">
    <div class="flex items-center justify-between">
      <div>
        <h2 id="contracts-heading" class="font-medium">Compliance Contracts ‚Ä¢ Contratos EN/ES</h2>
        <p class="text-xs text-slate-500">Draft bilingual agreements, upsell compliance retainers, and store them via <code>POST /api/contracts</code>.</p>
      </div>
      <button id="btnNewContract" class="btn text-sm">New Contract / Nuevo Contrato</button>
    </div>
    <p id="contractStatus" class="hidden rounded-lg bg-emerald-100 px-3 py-2 text-xs text-emerald-700"></p>
    <ul id="contractList" class="space-y-3 text-sm"></ul>
    <p id="contractEmpty" class="text-sm text-slate-500">No saved contracts yet. Offer a compliance upgrade with a bilingual agreement.</p>
  </section>

  <div class="glass card space-y-4">
    <div class="font-medium">Sequences</div>
    <div class="flex gap-4">
      <div class="w-1/3">
        <button id="newSequence" class="btn w-full mb-2">New Sequence</button>
        <div id="sequenceList" class="space-y-1 text-sm max-h-60 overflow-y-auto"></div>
      </div>
      <div class="flex-1 space-y-2">
        <input id="seqName" class="input w-full text-sm" placeholder="Sequence Name" />
        <div id="seqTemplates" class="checkbox-list w-full text-sm space-y-1 max-h-60 overflow-y-auto"></div>
        <button id="saveSequence" class="btn text-sm">Save Sequence</button>
      </div>
    </div>
  </div>
</main>
<!-- Template Editor Modal -->
<div id="templateModal" class="modal-backdrop">
  <div class="modal">
    <header>
      <div class="font-medium">Template Editor</div>
      <div class="flex gap-2">
        <button id="saveTemplate" class="btn text-sm">Save Template</button>
        <button id="saveTemplateCopy" class="btn text-sm">Save As New</button>
        <button id="cancelTemplate" class="btn text-sm">Close</button>
      </div>
    </header>
    <div id="tplEditor" class="body space-y-2">
      <input id="tplHeading" class="input w-full text-sm" placeholder="Heading" />
      <select id="tplType" class="input w-full text-sm">
        <option value="correct">Correct</option>
        <option value="delete">Delete</option>
      </select>
      <textarea id="tplIntro" class="input w-full text-sm" placeholder="Intro"></textarea>
      <textarea id="tplAsk" class="input w-full text-sm" placeholder="Ask"></textarea>
      <textarea id="tplAfter" class="input w-full text-sm" placeholder="After Issues"></textarea>
      <textarea id="tplEvidence" class="input w-full text-sm" placeholder="Evidence"></textarea>
      <div id="tplPreview" class="input w-full text-sm whitespace-pre-line h-48 overflow-y-auto" title="Drop a template here to load it"></div>
    </div>
  </div>
</div>
<div id="contractModal" class="modal-backdrop">
  <div class="modal">
    <header>
      <div>
        <div class="font-medium">Bilingual Contract Editor</div>
        <p class="text-xs text-slate-500">English + Espa√±ol copy, ready for e-sign or PDF export.</p>
      </div>
      <div class="flex gap-2">
        <button class="btn text-sm" type="button" data-close-contract>Close</button>
      </div>
    </header>
    <form id="contractForm" class="body space-y-3">
      <input id="contractName" name="name" class="input w-full text-sm" placeholder="Service Agreement Title / T√≠tulo del servicio" required />
      <div class="grid gap-3 md:grid-cols-2">
        <div class="space-y-2">
          <label class="text-xs font-semibold text-slate-500" for="contractEnglish">English Version</label>
          <textarea id="contractEnglish" name="english" class="input w-full h-48 text-sm" placeholder="Scope, guarantees (compliance-safe), payment schedule, cancellation window." required></textarea>
        </div>
        <div class="space-y-2">
          <label class="text-xs font-semibold text-slate-500" for="contractSpanish">Versi√≥n en Espa√±ol</label>
          <textarea id="contractSpanish" name="spanish" class="input w-full h-48 text-sm" placeholder="Alcance, garant√≠as (sin promesas irreales), plan de pagos, cancelaci√≥n."></textarea>
        </div>
      </div>
      <div class="flex items-center justify-between text-xs text-slate-500">
        <span>Tip: Mention Metro-2 compliance, bilingual support, and optional certified mail concierge.</span>
        <div class="flex gap-2">
          <button class="btn text-sm" type="submit">Save / Guardar</button>
          <button class="btn text-sm" type="button" data-close-contract>Cancel</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script type="module" src="/common.js"></script>
<script src="/library.js"></script>
</body>
</html>

