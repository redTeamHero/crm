<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@9.1.1/dist/css/shepherd.css">
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@9.1.1/dist/js/shepherd.min.js" defer></script>
<script>
(() => {
  const themes = {
    purple:{accent:'#AF52DE',hover:'#9333EA',bg:'#AF52DE',
            glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'},
    blue:{accent:'#007AFF',hover:'#005BB5',bg:'#007AFF',
          glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'},
    green:{accent:'#34C759',hover:'#248A3D',bg:'#34C759',
           glassBg:'rgba(255,255,255,0.4)',glassBrd:'rgba(255,255,255,0.25)'}
    // â€¦keep the rest of your themes
  };
  const name = localStorage.getItem('theme') || 'purple';
  const t = themes[name] || themes.purple;
  const r = document.documentElement.style;
  r.setProperty('--accent', t.accent);
  r.setProperty('--accent-hover', t.hover);
  r.setProperty('--accent-bg', t.bg);
  r.setProperty('--glass-bg', t.glassBg);
  r.setProperty('--glass-brd', t.glassBrd);
  r.setProperty('--btn-text', '#fff');
  document.documentElement.style.visibility = 'hidden';
  document.addEventListener('DOMContentLoaded', () => {
    document.documentElement.style.visibility = '';
  });
})();
</script>
<link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-o9N1j7k8fBRT1Q9ir3R8A4bMHt0gXu6p0UmmE8Zy+3E=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-oEnJPhGf6QjaxzX2LeLYI0m0CMvYZRyGmA4KQ1uYf3s=" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" integrity="sha384-LiXKzCcsMEY0Kx4PAvpc9L8AMBFvH1mpxi2BNfk4ULkpYLkFhYqpKfT/aJQgJWdL" crossorigin="anonymous"></script>
  <style>
    @keyframes blob{0%,100%{transform:translate(0,0);}33%{transform:translate(15px,-10px);}66%{transform:translate(-10px,10px);}}
    .animate-blob{animation:blob 10s ease-in-out infinite;}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    .animate-fadeInUp{animation:fadeInUp .6s ease-out both;}
    .confetti-piece{position:absolute;width:6px;height:6px;border-radius:1px;animation:confetti 1.2s ease-out forwards;}
    @keyframes confetti{to{transform:translate(var(--tx),var(--ty)) rotate(720deg);opacity:0;}}
  </style>
</head>
<body>
<header id="host-nav" class="p-4">
  <div class="max-w-7xl mx-auto glass card nav-shell">
    <div class="nav-brand-row">
      <div class="text-xl font-semibold">Metro 2 CRM</div>
      <button id="navToggle" class="btn md:hidden" type="button" aria-expanded="false" aria-controls="primaryNav">
        <span>Menu</span>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav id="primaryNav" class="hidden flex-col gap-2 md:flex md:flex-row md:items-center md:gap-2" aria-label="Primary">
      <div id="primaryNavLinks" class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
        <a href="/dashboard" class="btn nav-btn">Dashboard</a>
        <a href="/clients" class="btn nav-btn">Clients</a>
        <a href="/leads" class="btn nav-btn">Leads</a>
        <a href="/schedule" class="btn nav-btn">Schedule</a>
        <a href="/billing" class="btn nav-btn">Billing</a>
        <div class="nav-dropdown" id="navSettings">
          <button type="button" id="navSettingsToggle" class="btn nav-btn flex items-center justify-between md:justify-center gap-2" aria-expanded="false" aria-haspopup="true">
            <span>Settings</span>
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div id="navSettingsMenu" class="nav-dropdown-menu glass card p-2">
            <a id="navCompany" href="/my-company" class="btn text-sm">My Company</a>
            <a href="/letters" class="btn text-sm">Letter</a>
            <a href="/library" class="btn text-sm">Library</a>
            <a href="/workflows" class="btn text-sm">Workflows</a>
            <button id="btnInvite" class="btn text-sm" style="background: var(--green-bg);">Add Team Member</button>
          </div>
        </div>
        <a href="/tradelines" class="btn nav-btn">Tradelines</a>
        <button id="btnHelp" class="btn nav-btn" data-tip="Help (H)">Help</button>
        <div id="tierBadge" class="hidden sm:flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-2 text-emerald-700 shadow-sm" title="You've started your journey.">
          <span class="text-xl">ðŸ“„</span>
          <span class="font-semibold text-sm">Rookie</span>
        </div>
      </div>
    </nav>
  </div>
</header>
<main class="max-w-7xl mx-auto p-4 space-y-4">
  <div class="glass card relative overflow-hidden text-center">
    <div class="pointer-events-none absolute -top-16 -right-16 h-56 w-56 rounded-full bg-gradient-to-tr from-emerald-400 to-cyan-400 opacity-20 blur-3xl animate-blob"></div>
    <h2 class="mb-2 text-2xl font-bold">Welcome back!</h2>
    <p class="text-sm text-gray-600">Letâ€™s knock out todayâ€™s tasks.</p>
    <button id="btnGoal" class="mt-4 rounded-full bg-emerald-500 px-5 py-2.5 font-semibold text-white shadow hover:brightness-110 active:scale-95">Mark Todayâ€™s Goal Done</button>
    <div id="confetti" class="pointer-events-none absolute inset-0"></div>
  </div>

  <div class="grid grid-cols-1 gap-4 md:grid-cols-3 md:auto-rows-fr">
    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">News</div>
      <div id="newsFeed" class="text-sm space-y-1 flex-1">Loading...</div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">Messages</div>
      <div id="msgList" class="text-sm space-y-1 min-h-[80px] max-h-48 overflow-y-auto muted flex-1">No messages.</div>

    </div>

    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">Upcoming Events</div>
      <div id="eventList" class="text-sm space-y-1 min-h-[80px] max-h-48 overflow-y-auto muted flex-1">No events.</div>
    </div>
  </div>

  <div id="tourKpiSection" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4 sm:auto-rows-fr">
    <div class="glass card h-full flex flex-col">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-sm muted">Total Leads</div>
          <div id="dashLeads" class="text-2xl font-semibold">0</div>
        </div>
        <a href="#" class="btn text-xs detail-trigger" data-detail="leads">Details</a>
      </div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-sm muted">Total Clients</div>
          <div id="dashClients" class="text-2xl font-semibold">0</div>
        </div>
        <a href="#" class="btn text-xs detail-trigger" data-detail="clients">Details</a>
      </div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-sm muted">Sales</div>
          <div id="dashSales" class="text-2xl font-semibold">$0.00</div>
        </div>
        <a href="#" class="btn text-xs detail-trigger" data-detail="sales">Details</a>
      </div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="flex items-start justify-between">
        <div>
          <div class="text-sm muted">Payments</div>
          <div id="dashPayments" class="text-2xl font-semibold">$0.00</div>
        </div>
        <a href="#" class="btn text-xs detail-trigger" data-detail="payments">Details</a>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 md:auto-rows-fr">
    <div id="tourNotepadCard" class="glass card lg:col-span-2 h-full flex flex-col">
      <div class="flex items-center justify-between mb-2">
        <div class="font-medium">Notepad</div>
        <button id="dashSaveNote" class="btn text-sm">Save</button>
      </div>
      <input id="dashNoteTitle" class="w-full border rounded px-2 py-1 text-sm mb-2" placeholder="Note title" />
      <select id="noteSelect" class="w-full border rounded px-2 py-1 text-sm mb-2"><option value="">Select saved note...</option></select>

      <textarea id="dashNote" class="w-full h-40 border rounded p-2 text-sm"></textarea>
      <div id="noteList" class="mt-2 space-y-1 text-sm"></div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">Retention Rate</div>
      <div id="dashRetention" class="text-2xl font-semibold">0.0%</div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">Lead Conversion</div>
      <div id="dashConversion" class="text-2xl font-semibold">0.0%</div>
    </div>

    <div class="glass card h-full flex flex-col">
      <div class="font-medium mb-2">Company Deletion Statistics</div>
      <div id="dashDeletion" class="text-sm muted">No data</div>
    </div>

    <div id="tourMapCard" class="glass card md:col-span-2 lg:col-span-3 h-full flex flex-col">
      <div class="font-medium mb-2">Client Locations</div>
      <div id="clientMap" class="w-full h-64 rounded-lg"></div>
    </div>

  </div>

  <div id="detailModal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/40 backdrop-blur">
    <div class="glass card w-full max-w-3xl mx-4 relative">
      <button id="detailModalClose" class="absolute top-3 right-3 btn text-xs" aria-label="Close details">Close</button>
      <div class="space-y-4">
        <div>
          <h3 id="detailModalTitle" class="text-xl font-semibold">Metric Details</h3>
          <p id="detailModalSubtitle" class="text-sm muted">Last 6 months performance.</p>
        </div>
        <div class="w-full">
          <canvas id="detailChart" class="w-full h-64"></canvas>
        </div>
        <div>
          <h4 class="font-medium">Timeline</h4>
          <ul id="detailTimeline" class="mt-2 space-y-2 text-sm max-h-52 overflow-y-auto"></ul>
        </div>
      </div>
    </div>
  </div>

  </main>
  <button id="guideChatToggle" type="button" class="fixed bottom-4 right-4 z-40 flex items-center gap-2 rounded-full bg-[var(--accent)] px-4 py-2 text-white shadow-lg hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--accent)]">
    <span>Need a tour? / Â¿Necesitas guÃ­a?</span>
    <span aria-hidden="true">ðŸ’¬</span>
  </button>
  <section id="guideChatPanel" class="fixed bottom-4 right-4 z-40 hidden w-[min(360px,92vw)] rounded-2xl bg-white/95 shadow-2xl ring-1 ring-black/5 backdrop-blur">
    <div class="flex items-center justify-between border-b border-slate-200 px-4 py-3">
      <div>
        <p class="text-sm font-semibold text-slate-800">Guided Coach</p>
        <p class="text-xs text-slate-500">Onboarding support / Soporte de onboarding</p>
      </div>
      <div class="flex items-center gap-2">
        <button id="guideChatTour" type="button" class="btn text-xs bg-[var(--accent)] text-white px-3 py-1">Start tour</button>
        <button id="guideChatClose" type="button" class="btn text-xs px-3 py-1">Ã—</button>
      </div>
    </div>
    <div id="guideChatMessages" class="flex max-h-72 flex-col gap-3 overflow-y-auto px-4 py-3 text-sm" role="log" aria-live="polite"></div>
    <div class="border-t border-slate-200 px-4 py-3">
      <div class="mb-2 space-y-2" id="guideChatQuick">
        <div id="guideChatCategories" class="flex flex-wrap gap-2"></div>
        <div id="guideChatPrompts" class="flex flex-wrap gap-2"></div>
      </div>
      <form id="guideChatForm" class="flex items-center gap-2">
        <label class="sr-only" for="guideChatInput">Ask the coach</label>
        <input id="guideChatInput" class="flex-1 rounded-full border border-slate-200 px-3 py-2 text-sm focus:border-[var(--accent)] focus:outline-none" placeholder="Ask the coach / Pregunta al coach" autocomplete="off" />
        <button type="submit" class="btn bg-[var(--accent)] px-4 py-2 text-sm font-semibold text-white">Send</button>
      </form>
    </div>
  </section>
  <script type="module" src="/common.js"></script>
  <script src="/hotkeys.js"></script>
  <script type="module" src="/dashboard.js"></script>
</body>
</html>
