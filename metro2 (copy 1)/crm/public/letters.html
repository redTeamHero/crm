<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Generated Letters</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
<script src="/theme.js"></script>
<link rel="stylesheet" href="/style.css">
  <style>
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(1100px,96vw);height:min(90vh,900px);border-radius:18px;box-shadow:0 20px 60px rgba(15,23,42,.18);background:var(--surface-strong);display:flex;flex-direction:column;overflow:hidden;border:1px solid var(--border-soft)}
    .modal header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border-soft);background:var(--glass-bg);backdrop-filter: blur(10px)}
    .modal iframe{flex:1;width:100%;border:0}
  </style>
</head>
<body>
<header id="host-nav" class="p-4">
  <div class="max-w-7xl mx-auto glass card nav-shell">
    <div class="nav-brand-row">
      <div class="text-xl font-semibold">Metro 2 CRM</div>
      <button id="navToggle" class="btn md:hidden" type="button" aria-expanded="false" aria-controls="primaryNav">
        <span>Menu</span>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav id="primaryNav" class="hidden flex-col gap-2 md:flex md:flex-row md:items-center md:gap-2" aria-label="Primary">
      <div id="primaryNavLinks" class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
        <a href="/dashboard" class="btn nav-btn">Dashboard</a>
        <a href="/clients" class="btn nav-btn">Clients</a>
        <a href="/leads" class="btn nav-btn">Leads</a>
        <a href="/schedule" class="btn nav-btn">Schedule</a>
        <a href="/billing" class="btn nav-btn">Billing</a>
        <div class="nav-dropdown" id="navSettings">
          <button type="button" id="navSettingsToggle" class="btn nav-btn flex items-center justify-between md:justify-center gap-2" aria-expanded="false" aria-haspopup="true">
            <span>Settings</span>
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div id="navSettingsMenu" class="nav-dropdown-menu glass card p-2">
            <a id="navCompany" href="/my-company" class="btn text-sm">My Company</a>
            <a href="/letters" class="btn text-sm">Letter</a>
            <a href="/library" class="btn text-sm">Library</a>
            <a href="/workflows" class="btn text-sm">Workflows</a>
            <button id="btnInvite" class="btn text-sm" style="background: var(--green-bg);">Add Team Member</button>
          </div>
        </div>
        <a href="/tradelines" class="btn nav-btn">Tradelines</a>
        <button id="btnHelp" class="btn nav-btn" data-tip="Help (H)">Help</button>
        <div id="tierBadge" class="hidden sm:flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-2 text-emerald-700 shadow-sm" title="You've started your journey.">
          <span class="text-xl">üìÑ</span>
          <span class="font-semibold text-sm">Rookie</span>
        </div>
      </div>
    </nav>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4 space-y-4">
  <div id="jobsSection" class="glass card space-y-2 hidden">
    <div class="font-medium">Letter Jobs</div>
    <div id="jobList" class="space-y-2 text-sm"></div>
  </div>

  <div id="lettersSection">
    <div class="text-sm muted">Job: <span id="jobId">‚Äî</span></div>
    <div id="err" class="hidden p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg"></div>

    <div class="glass card text-center">
      <div class="flex flex-col items-center gap-2">
        <div class="font-medium">Letters</div>
        <div class="flex flex-wrap items-center justify-center gap-2">
          <button id="btnDownloadAll" class="btn" data-tip="Download all letters as ZIP">Download All</button>
          <button id="btnPortalAll" class="btn" data-tip="Upload letters to client portal">Send to Portal</button>
          <button id="btnEmailAll" class="btn" data-tip="Email letters as PDF attachments">Email All</button>
          <button id="btnBack" class="btn">‚Üê Back to CRM</button>
        </div>
      </div>

      <div id="count" class="text-sm muted mt-1"></div>
      <div id="cards" class="grid gap-4 grid-cols-1 md:grid-cols-2 xl:grid-cols-3 mt-3"></div>

      <div class="flex items-center justify-between mt-4">
        <button id="prev" class="btn">‚Äπ Prev</button>
        <div class="text-sm muted">Page <span id="pnum">1</span> / <span id="ptotal">1</span></div>
        <button id="next" class="btn">Next ‚Ä∫</button>
      </div>
    </div>
  </div>
</main>

<!-- Preview Modal -->
<div id="previewModal" class="modal-backdrop">
  <div class="modal">
    <header>
      <div>
        <div class="font-medium" id="pvTitle">Preview</div>
        <div class="text-xs muted" id="pvMeta"></div>
      </div>
      <div class="flex items-center gap-2">
        <a id="pvOpen" target="_blank" class="btn">Open HTML</a>
        <button id="pvPrint" class="btn">Print</button>
        <button id="pvClose" class="btn">Close</button>
      </div>
    </header>
    <div id="pvBody" class="flex flex-1">
      <iframe id="pvFrame" class="flex-1 h-full" src="about:blank"></iframe>
    </div>
  </div>
</div>

<script type="module" src="/common.js"></script>
  <script src="/hotkeys.js"></script>
<script src="letters.js" type="module"></script>
</body>
</html>
