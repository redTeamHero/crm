<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Generated Letters</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
<script src="/theme.js"></script>
<link rel="stylesheet" href="/style.css">
  <style>
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{width:min(1100px,96vw);height:min(90vh,900px);border-radius:18px;box-shadow:0 20px 60px rgba(15,23,42,.18);background:var(--surface-strong);display:flex;flex-direction:column;overflow:hidden;border:1px solid var(--border-soft)}
    .modal header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border-soft);background:var(--glass-bg);backdrop-filter: blur(10px)}
    .modal iframe{flex:1;width:100%;border:0}
  </style>
</head>
<body>
<header id="host-nav" class="p-4">
  <div class="max-w-7xl mx-auto glass card nav-shell">
    <div class="nav-brand-row">
      <div class="text-xl font-semibold">Metro 2 CRM</div>
      <button id="navToggle" class="btn md:hidden" type="button" aria-expanded="false" aria-controls="primaryNav">
        <span>Menu</span>
        <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav id="primaryNav" class="hidden flex-col gap-2 md:flex md:flex-row md:items-center md:gap-2" aria-label="Primary">
      <div id="primaryNavLinks" class="flex flex-col md:flex-row md:items-center gap-2 w-full md:w-auto">
        <a href="/dashboard" class="btn nav-btn">Dashboard</a>
        <a href="/clients" class="btn nav-btn">Clients</a>
        <a href="/leads" class="btn nav-btn">Leads</a>
        <a href="/schedule" class="btn nav-btn">Schedule</a>
        <a href="/billing" class="btn nav-btn">Billing</a>
        <div class="nav-dropdown" id="navSettings">
          <button type="button" id="navSettingsToggle" class="btn nav-btn flex items-center justify-between md:justify-center gap-2" aria-expanded="false" aria-haspopup="true">
            <span>Settings</span>
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div id="navSettingsMenu" class="nav-dropdown-menu glass card p-2">
            <a id="navCompany" href="/my-company" class="btn text-sm">My Company</a>
            <a href="/letters" class="btn text-sm">Letter</a>
            <a href="/library" class="btn text-sm">Library</a>
            <a href="/settings#api-integrations" class="btn text-sm">APIs</a>
            <a href="/workflows" class="btn text-sm">Workflows</a>
            <button id="btnInvite" class="btn text-sm" style="background: var(--green-bg);">Add Team Member</button>
          </div>
        </div>
        <a href="/tradelines" class="btn nav-btn">Tradelines</a>
        <button id="btnHelp" class="btn nav-btn" data-tip="Help (H)">Help</button>
        <div id="tierBadge" class="hidden sm:flex items-center gap-2 rounded-full bg-emerald-100 px-4 py-2 text-emerald-700 shadow-sm" title="You've started your journey.">
          <span class="text-xl">üìÑ</span>
          <span class="font-semibold text-sm">Rookie</span>
        </div>
      </div>
    </nav>
  </div>
</header>

<main class="max-w-7xl mx-auto p-4 space-y-4">
  <div id="jobsSection" class="hidden space-y-6">
    <section class="glass card overflow-hidden p-0">
      <div class="relative">
        <div class="absolute inset-0 bg-gradient-to-r from-sky-500/80 via-indigo-500/80 to-purple-500/75"></div>
        <div class="relative px-6 py-8 text-white space-y-3">
          <p class="text-xs uppercase tracking-[0.35em] text-white/70">Letter Ops</p>
          <h1 class="text-3xl font-semibold leading-tight">Letter Jobs</h1>
          <p class="text-sm md:text-base text-white/80 max-w-2xl">
            Track generated dispute letter batches, prep client deliverables, and keep your Metro-2 workflow organized.
          </p>
        </div>
      </div>
      <div class="border-t border-white/30 bg-white/85 backdrop-blur px-6 py-5">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-end lg:justify-between">
          <div class="flex flex-col gap-3">
            <dl class="grid gap-4 sm:grid-cols-3 text-sm">
              <div class="rounded-2xl border border-slate-200/80 bg-white/80 px-4 py-3 shadow-sm">
                <dt class="text-xs uppercase tracking-wide text-slate-500">Total Jobs</dt>
                <dd class="mt-1 text-2xl font-semibold text-slate-900" id="jobTotal">0</dd>
              </div>
              <div class="rounded-2xl border border-slate-200/80 bg-white/80 px-4 py-3 shadow-sm">
                <dt class="text-xs uppercase tracking-wide text-slate-500">Letters Generated</dt>
                <dd class="mt-1 text-2xl font-semibold text-slate-900" id="jobLettersTotal">0</dd>
              </div>
              <div class="rounded-2xl border border-slate-200/80 bg-white/80 px-4 py-3 shadow-sm">
                <dt class="text-xs uppercase tracking-wide text-slate-500">Last Run</dt>
                <dd class="mt-1 text-base font-semibold text-slate-900" id="jobLastRun">‚Äî</dd>
              </div>
            </dl>
            <p id="jobSummaryNote" class="text-xs uppercase tracking-wide text-slate-500">Showing 0 of 0 jobs</p>
          </div>
          <div class="w-full max-w-md">
            <label for="jobSearch" class="text-xs uppercase tracking-wide text-slate-500">Search clients</label>
            <div class="mt-2 flex items-center gap-2 rounded-2xl border border-slate-200/70 bg-white/90 px-3 py-2 shadow-inner">
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <circle cx="11" cy="11" r="7"></circle>
                <line x1="20" y1="20" x2="16.65" y2="16.65"></line>
              </svg>
              <input id="jobSearch" type="search" placeholder="Search by client, ID, or job" class="w-full bg-transparent text-sm text-slate-700 placeholder:text-slate-400 focus:outline-none" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <div id="jobsError" class="hidden rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"></div>

    <div id="jobsEmpty" class="hidden rounded-2xl border border-slate-200 bg-white/90 px-5 py-6 text-center text-sm text-slate-600">
      <p class="font-medium text-slate-700">No letter jobs yet</p>
      <p class="mt-2 text-slate-500">Launch a dispute playbook or import a report to generate your first batch.</p>
      <div class="mt-3 flex justify-center">
        <a href="/clients" class="btn text-sm">Go to Clients</a>
      </div>
    </div>

    <div id="jobList" class="grid gap-4 md:grid-cols-2 xl:grid-cols-3"></div>
  </div>

  <div id="lettersSection">
    <div class="text-sm muted">Job: <span id="jobId">‚Äî</span></div>
    <div id="err" class="hidden p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg"></div>

    <div class="glass card text-center">
      <div class="flex flex-col items-center gap-2">
        <div class="font-medium">Letters</div>
        <div class="flex flex-wrap items-center justify-center gap-2">
          <button id="btnDownloadAll" class="btn" data-tip="Download all letters as ZIP">Download All</button>
          <button id="btnPortalAll" class="btn" data-tip="Upload letters to client portal">Send to Portal</button>
          <button id="btnEmailAll" class="btn" data-tip="Email letters as PDF attachments">Email All</button>
          <button id="btnBack" class="btn">‚Üê Back to CRM</button>
        </div>
      </div>

      <div id="count" class="text-sm muted mt-1"></div>
      <div id="cards" class="grid gap-4 grid-cols-1 md:grid-cols-2 xl:grid-cols-3 mt-3"></div>

      <div class="flex items-center justify-between mt-4">
        <button id="prev" class="btn">‚Äπ Prev</button>
        <div class="text-sm muted">Page <span id="pnum">1</span> / <span id="ptotal">1</span></div>
        <button id="next" class="btn">Next ‚Ä∫</button>
      </div>
    </div>
  </div>
</main>

<!-- Preview Modal -->
<div id="previewModal" class="modal-backdrop">
  <div class="modal">
    <header>
      <div>
        <div class="font-medium" id="pvTitle">Preview</div>
        <div class="text-xs muted" id="pvMeta"></div>
      </div>
      <div class="flex items-center gap-2">
        <a id="pvOpen" target="_blank" class="btn">Open HTML</a>
        <button id="pvPrint" class="btn">Print</button>
        <button id="pvClose" class="btn">Close</button>
      </div>
    </header>
    <div id="pvBody" class="flex flex-1">
      <iframe id="pvFrame" class="flex-1 h-full" src="about:blank"></iframe>
    </div>
  </div>
</div>

<script type="module" src="/common.js"></script>
  <script src="/hotkeys.js"></script>
<script src="letters.js" type="module"></script>
</body>
</html>
